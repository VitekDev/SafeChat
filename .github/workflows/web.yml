name: Build

on:
  push:
    branches: [ master ]

jobs:
  build:
    name: 🎉 Build
    runs-on: ubuntu-latest

    steps:
      - name: 🚚 Get latest code
        uses: actions/checkout@v2

      - name: 🧩 Insert Secrets
        run: |
          echo "// File generated by FlutterFire CLI." > lib/firebase_options.dart
          echo "// ignore_for_file: lines_longer_than_80_chars, avoid_classes_with_only_static_members" >> lib/firebase_options.dart
          echo "import 'package:firebase_core/firebase_core.dart'" >> lib/firebase_options.dart
          echo "    show FirebaseOptions;" >> lib/firebase_options.dart
          echo "import 'package:flutter/foundation.dart'" >> lib/firebase_options.dart
          echo "    show defaultTargetPlatform, kIsWeb, TargetPlatform;" >> lib/firebase_options.dart
          
          echo "/// Default [FirebaseOptions] for use with your Firebase apps." >> lib/firebase_options.dart
          echo "///" >> lib/firebase_options.dart
          echo "/// Example:" >> lib/firebase_options.dart
          echo "/// ```dart" >> lib/firebase_options.dart
          echo "/// import 'firebase_options.dart';" >> lib/firebase_options.dart
          echo "/// // ..." >> lib/firebase_options.dart
          echo "/// await Firebase.initializeApp(" >> lib/firebase_options.dart
          echo "///   options: DefaultFirebaseOptions.currentPlatform," >> lib/firebase_options.dart
          echo "/// );" >> lib/firebase_options.dart
          echo "/// ```" >> lib/firebase_options.dart
          echo "class DefaultFirebaseOptions {" >> lib/firebase_options.dart
          echo "  static FirebaseOptions get currentPlatform {" >> lib/firebase_options.dart
          echo "    if (kIsWeb) {" >> lib/firebase_options.dart
          echo "      return web;" >> lib/firebase_options.dart
          echo "    }" >> lib/firebase_options.dart
          echo "    switch (defaultTargetPlatform) {" >> lib/firebase_options.dart
          echo "      case TargetPlatform.android:" >> lib/firebase_options.dart
          echo "        return android;" >> lib/firebase_options.dart
          echo "      case TargetPlatform.iOS:" >> lib/firebase_options.dart
          echo "        return ios;" >> lib/firebase_options.dart
          echo "      case TargetPlatform.macOS:" >> lib/firebase_options.dart
          echo "        return macos;" >> lib/firebase_options.dart
          echo "      case TargetPlatform.windows:" >> lib/firebase_options.dart
          echo "        throw UnsupportedError(" >> lib/firebase_options.dart
          echo "          'DefaultFirebaseOptions have not been configured for windows - '" >> lib/firebase_options.dart
          echo "          'you can reconfigure this by running the FlutterFire CLI again.'," >> lib/firebase_options.dart
          echo "        );" >> lib/firebase_options.dart
          echo "      case TargetPlatform.linux:" >> lib/firebase_options.dart
          echo "        throw UnsupportedError(" >> lib/firebase_options.dart
          echo "          'DefaultFirebaseOptions have not been configured for linux - '" >> lib/firebase_options.dart
          echo "          'you can reconfigure this by running the FlutterFire CLI again.'," >> lib/firebase_options.dart
          echo "        );" >> lib/firebase_options.dart
          echo "      default:" >> lib/firebase_options.dart
          echo "        throw UnsupportedError(" >> lib/firebase_options.dart
          echo "          'DefaultFirebaseOptions are not supported for this platform.'," >> lib/firebase_options.dart
          echo "        );" >> lib/firebase_options.dart
          echo "    }" >> lib/firebase_options.dart
          echo "  }" >> lib/firebase_options.dart
          
          echo "  static const FirebaseOptions web = FirebaseOptions(" >> lib/firebase_options.dart
          echo "    apiKey: '${{secrets.APIKEY }}'," >> lib/firebase_options.dart
          echo "    appId: '${{secrets.APPID }}'," >> lib/firebase_options.dart
          echo "    messagingSenderId: '${{secrets.MESSAGINGSENDERID }}'," >> lib/firebase_options.dart
          echo "    projectId: '${{secrets.PROJECTID }}'," >> lib/firebase_options.dart
          echo "    authDomain: '${{secrets.AUTHDOMAIN }}'," >> lib/firebase_options.dart
          echo "    storageBucket: '${{secrets.STORAGEBUCKET }}'," >> lib/firebase_options.dart
          echo "    measurementId: '${{secrets.MEASUREMENTID }}'," >> lib/firebase_options.dart
          echo "  );" >> lib/firebase_options.dart
          
          echo "  static const FirebaseOptions android = FirebaseOptions(" >> lib/firebase_options.dart
          echo "    apiKey: 'AIzaSyBQmm2qkzplZLWjjLqQA2IFhPRkNCgBOvU'," >> lib/firebase_options.dart
          echo "    appId: '1:80078589156:android:f0f32f662e803c003e30f1'," >> lib/firebase_options.dart
          echo "    messagingSenderId: '80078589156'," >> lib/firebase_options.dart
          echo "    projectId: 'chat-92d56'," >> lib/firebase_options.dart
          echo "    storageBucket: 'chat-92d56.appspot.com'," >> lib/firebase_options.dart
          echo "  );" >> lib/firebase_options.dart
          
          echo "  static const FirebaseOptions ios = FirebaseOptions(" >> lib/firebase_options.dart
          echo "    apiKey: 'AIzaSyCHJ7QClnIy_zM4-eQyRjuUuqx62wWiR6s'," >> lib/firebase_options.dart
          echo "    appId: '1:80078589156:ios:0bf807b81beea1523e30f1'," >> lib/firebase_options.dart
          echo "    messagingSenderId: '80078589156'," >> lib/firebase_options.dart
          echo "    projectId: 'chat-92d56'," >> lib/firebase_options.dart
          echo "    storageBucket: 'chat-92d56.appspot.com'," >> lib/firebase_options.dart
          echo "    iosClientId:" >> lib/firebase_options.dart
          echo "        '80078589156-od1eglniccojel1ob9hjtvsuo2ngikkf.apps.googleusercontent.com'," >> lib/firebase_options.dart
          echo "    iosBundleId: 'com.example.chatApp'," >> lib/firebase_options.dart
          echo "  );" >> lib/firebase_options.dart
          
          echo "  static const FirebaseOptions macos = FirebaseOptions(" >> lib/firebase_options.dart
          echo "    apiKey: 'AIzaSyCHJ7QClnIy_zM4-eQyRjuUuqx62wWiR6s'," >> lib/firebase_options.dart
          echo "    appId: '1:80078589156:ios:0bf807b81beea1523e30f1'," >> lib/firebase_options.dart
          echo "    messagingSenderId: '80078589156'," >> lib/firebase_options.dart
          echo "    projectId: 'chat-92d56'," >> lib/firebase_options.dart
          echo "    storageBucket: 'chat-92d56.appspot.com'," >> lib/firebase_options.dart
          echo "    iosClientId:" >> lib/firebase_options.dart
          echo "        '80078589156-od1eglniccojel1ob9hjtvsuo2ngikkf.apps.googleusercontent.com'," >> lib/firebase_options.dart
          echo "    iosBundleId: 'com.example.chatApp'," >> lib/firebase_options.dart
          echo "  );" >> lib/firebase_options.dart
          echo "}" >> lib/firebase_options.dart
        
      - name: 🎉 Build
        uses: subosito/flutter-action@v1

      - name: 🎉 Build Web
        uses: bluefireteam/flutter-gh-pages@v7
        with:
          baseHref: /SafeChat/
        
      - name: 🎉 Build Android
        run: flutter build apk
      - name: 🎉 Publish
        uses: actions/upload-artifact@v1
        with:
          name: SafeChat
          path: build/app/outputs/apk/release/app-release.apk
